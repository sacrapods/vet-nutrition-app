<section class="card upload-card">
  <div class="card-head"><h3>Attach Files</h3></div>
  <form method="post" enctype="multipart/form-data" action="{% url 'pet_admin_portal:create_attachment' parent.id pet.id %}" class="form-grid upload-form">
    {% csrf_token %}
    <div>
      {{ attachment_form.title.label_tag }}
      {{ attachment_form.title }}
      {% if attachment_form.title.errors %}
        <small class="field-error">{{ attachment_form.title.errors|join:", " }}</small>
      {% endif %}
    </div>

    <div class="modern-file-picker" data-file-picker>
      <label for="{{ attachment_form.file.id_for_label }}">{{ attachment_form.file.label }}</label>
      {{ attachment_form.file }}
      <div class="picker-row">
        <label for="{{ attachment_form.file.id_for_label }}" class="picker-trigger">Choose Attachment</label>
        <span class="picker-name" data-file-name>No file selected</span>
      </div>
      {% if attachment_form.file.errors %}
        <small class="field-error">{{ attachment_form.file.errors|join:", " }}</small>
      {% endif %}
    </div>

    <button class="btn-primary upload-submit" type="submit">Upload File</button>
    {% if attachment_uploaded %}
      <p class="upload-inline-success">Attachment uploaded successfully.</p>
    {% endif %}
  </form>
</section>
<section class="card uploaded-files-card">
  <div class="file-grid">
    {% for file in attachments %}
      <article class="file-card">
        <h4>{{ file.title|default:file.file.name }}</h4>
        {% if file.extension == 'jpg' or file.extension == 'jpeg' or file.extension == 'png' or file.extension == 'gif' or file.extension == 'webp' %}
          <img src="{{ file.file.url }}" alt="{{ file.title|default:'attachment' }}">
        {% endif %}
        <div class="file-card-actions">
          <a class="btn-link" href="{{ file.file.url }}" target="_blank">Preview</a>
          <form method="post" action="{% url 'pet_admin_portal:soft_delete_record' 'attachment' file.id %}" class="file-delete-form">
            {% csrf_token %}
            <button class="btn-danger" type="submit">Delete</button>
          </form>
        </div>
      </article>
    {% empty %}<p>No files uploaded.</p>{% endfor %}
  </div>
</section>
