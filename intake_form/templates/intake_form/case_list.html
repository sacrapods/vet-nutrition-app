<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cases - Poshtik NutriVet</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;background:#FAF7F2;color:#2C2C2C;line-height:1.6}
        .container{max-width:1000px;margin:0 auto;padding:24px}

        .header{background:linear-gradient(135deg,#3D6B42,#5A9E60,#7AB87F);padding:32px 32px 28px;border-radius:16px;color:white;margin-bottom:28px;position:relative;overflow:hidden}
        .header::before{content:'';position:absolute;top:-40px;right:-40px;width:180px;height:180px;background:rgba(255,255,255,0.06);border-radius:50%}
        .header-row{display:flex;justify-content:space-between;align-items:center;position:relative;z-index:1}
        .header h1{font-size:1.6rem;font-weight:700;letter-spacing:-0.3px}
        .header p{font-size:0.85rem;opacity:0.8;margin-top:4px}
        .btn-new{background:rgba(255,255,255,0.15);color:white;padding:10px 20px;border-radius:10px;font-weight:600;font-size:0.85rem;text-decoration:none;border:1.5px solid rgba(255,255,255,0.3);transition:all 0.2s}
        .btn-new:hover{background:rgba(255,255,255,0.25);text-decoration:none}

        .stats{display:flex;gap:12px;margin-bottom:20px}
        .stat-card{background:white;border-radius:8px;padding:8px 16px;display:flex;align-items:center;gap:8px;box-shadow:0 1px 4px rgba(0,0,0,0.04);border:1px solid #f0ede8}
        .stat-card .num{font-size:1rem;font-weight:700;color:#3D6B42}
        .stat-card .label{font-size:0.75rem;color:#999;text-transform:uppercase;letter-spacing:0.4px}

        .search{display:flex;gap:10px;margin-bottom:24px}
        .search input{flex:1;padding:12px 18px;border:1.5px solid #D9D4CC;border-radius:10px;font-size:0.95rem;background:white;transition:border 0.2s}
        .search input:focus{outline:none;border-color:#5A9E60;box-shadow:0 0 0 3px rgba(90,158,96,0.1)}
        .search button{padding:12px 24px;background:#3D6B42;color:white;border:none;border-radius:10px;cursor:pointer;font-size:0.9rem;font-weight:600;transition:background 0.2s}
        .search button:hover{background:#2C5432}

        .case-list{background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.04);border:1px solid #f0ede8;overflow:hidden}
        .case-row{display:flex;align-items:center;padding:14px 20px;border-bottom:1px solid #f5f2ed;text-decoration:none;color:inherit;transition:background 0.15s;cursor:pointer;gap:16px}
        .case-row:last-child{border-bottom:none}
        .case-row:hover{background:#FAFEF8}

        .case-id{font-family:'SF Mono',SFMono-Regular,Menlo,monospace;font-size:0.8rem;color:#C17A5A;font-weight:700;white-space:nowrap;width:130px;flex-shrink:0}
        .case-pet{font-weight:600;font-size:0.9rem;width:120px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .case-breed{font-size:0.8rem;color:#888;width:100px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .case-owner{font-size:0.85rem;color:#666;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .case-date{font-size:0.78rem;color:#bbb;white-space:nowrap;width:90px;flex-shrink:0;text-align:right}
        .print-btn{padding:5px 14px;border-radius:6px;font-size:0.75rem;font-weight:600;text-decoration:none;background:#F8F4F0;color:#8B7355;border:1px solid #E8DDD0;transition:background 0.15s;white-space:nowrap;flex-shrink:0}
        .print-btn:hover{background:#E8DDD0;text-decoration:none}

        .empty{text-align:center;padding:40px 20px;color:#bbb;font-size:0.9rem}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-row">
                <div>
                    <h1>Poshtik NutriVet</h1>
                    <p>Canine Clinical Nutrition &mdash; Case Dashboard</p>
                </div>
                <a href="{% url 'intake_form' %}" class="btn-new">+ New Form</a>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <span class="num">{{ parents|length }}</span>
                <span class="label">Total Cases</span>
            </div>
            <div class="stat-card">
                <span class="num">{% now "d M" %}</span>
                <span class="label">Today</span>
            </div>
        </div>

        <form class="search" method="get">
            <input type="text" name="q" placeholder="Search by owner name, case ID, or pet name..." value="{{ q }}" autofocus>
            <button type="submit">Search</button>
        </form>

        <div class="case-list">
            {% for parent in parents %}
            {% for pet in parent.pets.all %}
            <a href="{% url 'case_detail' pet.pk %}" class="case-row">
                <span class="case-id">{{ parent.case_id }}</span>
                <span class="case-pet">{{ pet.name }}</span>
                <span class="case-breed">{{ pet.breed }}</span>
                <span class="case-owner">{{ parent.name }} &middot; {{ parent.email }}</span>
                <span class="case-date">{{ parent.created_at|date:"d M Y" }}</span>
                <span onclick="event.preventDefault();event.stopPropagation();window.location='{% url 'case_pdf' pet.pk %}';" class="print-btn">Print</span>
            </a>
            {% endfor %}
            {% empty %}
            <div class="empty">No cases found{% if q %} matching "{{ q }}"{% endif %}.</div>
            {% endfor %}
        </div>
    </div>
</body>
</html>
